---
title: "Legal Reasonableness - Analysis"
output: html_notebook
---
```{r}

# Load Libraries

library(dplyr)
library(purrr)
library(readxl)
library(stats)

```

# Analysis 1: Overall results, mean ratings [following Bear & Knobe 2016]

```{r}

## Step 1: Exclude participants whose answer to Q19 does not equal 15 [comprehension/attention question].

Data_All_Average_Pass1 <- Data_All_Average[Data_All_Average$q19 == 15, ]
Data_All_Ideal_Pass1 <- Data_All_Ideal[Data_All_Ideal$q19 == 15, ]
Data_All_Reasonable_Pass1 <- Data_All_Reasonable[Data_All_Reasonable$q19 == 15, ]

```
 
```{r}

## Step 2: For each of the 33 questions (e.g. Q1, Q2, but not Q19) and each of the 3 conditions (reasonable, average, or ideal), compute the mean rating. For any response that is greater than 3 standard deviations from that question mean, exclude that response.

### Make Column Numbers

question_cols <- paste0("q", c(1:18, 20:34)) # Make Column Numbers

### Make Sure All Data is Perceived as Numeric

Data_All_Average_Pass1[question_cols] <- lapply(Data_All_Average_Pass1[question_cols], as.numeric)

Data_All_Ideal_Pass1[question_cols] <- lapply(Data_All_Ideal_Pass1[question_cols], as.numeric)

Data_All_Reasonable_Pass1[question_cols] <- lapply(Data_All_Reasonable_Pass1[question_cols], as.numeric)


### Create a function to apply the exclusion criterion and calculate mean and standard deviation to each column
filter_data <- function(data) {
  #### Loop through columns and apply filter
  for (question_cols in names(data)) {
    avg <- mean(data[[question_cols]], na.rm = TRUE)
    s <- sd(data[[question_cols]], na.rm = TRUE)
    data <- data[abs(data[[question_cols]] - avg) <= 3 * s, ]
  }
  return(data)
}

### Filter Data with 3 SD

Data_All_Average_Exclusions <- filter_data(Data_All_Average_Pass1[, question_cols])
Data_All_Ideal_Exclusions <- filter_data(Data_All_Ideal_Pass1[, question_cols])
Data_All_Reasonable_Exclusions <- filter_data(Data_All_Reasonable_Pass1[, question_cols])

### Calculate the mean for each column after excluding outlier responses

filtered_column_means_average <- colMeans(Data_All_Average_Exclusions[, question_cols], na.rm = TRUE)

filtered_column_means_reasonable <- colMeans(Data_All_Reasonable_Exclusions[, question_cols], na.rm = TRUE)

filtered_column_means_ideal <- colMeans(Data_All_Ideal_Exclusions[, question_cols], na.rm = TRUE)

```

```{r}

## Step 3: Convert mean responses to a natural log scale.

log_filtered_column_means_average <- log(filtered_column_means_average)

log_filtered_column_means_reasonable <- log(filtered_column_means_reasonable)

log_filtered_column_means_ideal <- log(filtered_column_means_ideal)

print(paste("LogAverages for Averages: ", log_filtered_column_means_average))
print(paste("LogAverages for Reasonable:", log_filtered_column_means_reasonable))
print(paste("LogAverages for Ideal:", log_filtered_column_means_ideal))

```

```{r}

## Step 4: Conduct three regressions: (Model I) one in which average predicts reasonable, (Model II) one in which ideal predicts reasonable, (Model III) one in which both average and ideal predict reasonable judgments. For each regression, record the AIC.

### Make a new DataFrame

dataforAICMeans <- data.frame(Reasonable = log_filtered_column_means_reasonable, Average = log_filtered_column_means_average, Ideal = log_filtered_column_means_ideal)

### Conduct Regressions

#### Model I

Model1Means <- lm(Reasonable ~ Average, data=dataforAICMeans)
AIC1Means <- AIC(Model1Means)

#### Model II

Model2Means <- lm(Reasonable ~ Ideal, data=dataforAICMeans)
AIC2Means <- AIC(Model2Means)

#### Model III

Model3Means <- lm(Reasonable ~ Average + Ideal, data=dataforAICMeans)
AIC3Means <- AIC(Model3Means)

print(paste("AIC for Model 1 - Average predicts Reasonable: ", AIC1Means))
print(paste("AIC for Model 2 - Ideal predicts Reasonable", AIC2Means))
print(paste("AIC for Model 3 - Average and Ideal predict Reasonable", AIC3Means))


```

# Analysis 2: Overall results, intermediacy [following Bear & Knobe 2016]

```{r}

# Step 1: Exclude participants whose answer to Q19 does not equal 15 [comprehension/attention question].

## Previously Calculated in Part 1


# Step 2: For each of the 33 questions (e.g. Q1, Q2, but not Q19) and each of the 3 conditions (reasonable, average, or ideal), compute the mean rating. For any response that is greater than 3 standard deviations from that question mean, exclude that response. 

## Previously Calculated in Part 1


# Step 3: For each question, compute whether the mean reasonableness rating is on the “ideal side” of average. Conduct a binomial test to assess whether the proportion of mean ratings on the “ideal side of the average” is greater than 50%. 

## Determine if reasonableness is on the "ideal side" of average for each question
is_ideal_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - average) > abs(ideal - average), 1, 0)
}

ideal_side_vector <- mapply(is_ideal_side, 
                            filtered_column_means_average, 
                            filtered_column_means_ideal, 
                            filtered_column_means_reasonable)

ideal_side_vector_log <- mapply(is_ideal_side, 
                            log_filtered_column_means_average, 
                            log_filtered_column_means_ideal, 
                            log_filtered_column_means_reasonable)

## Count how many times reasonableness is on the "ideal side" of average
count_ideal_side <- sum(ideal_side_vector)
count_ideal_side_log <- sum(ideal_side_vector_log)

## Conduct a binomial test
binomial_result_ideal <- binom.test(count_ideal_side, length(question_cols), p = 0.5, alternative = "greater")

binomial_result_ideal_log <- binom.test(count_ideal_side_log, length(question_cols), p = 0.5, alternative = "greater")

print(binomial_result_ideal)
print(binomial_result_ideal_log)

# Step 4: For each question, compute whether the mean reasonableness rating is on the “average side” of ideal. Conduct a binomial test to assess whether the proportion of mean ratings on the “average side of the ideal” is greater than 50%. 

## Determine if reasonableness is on the "average side" of ideal for each question
is_average_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - ideal) > abs(average - ideal), 1, 0)
}

average_side_vector <- mapply(is_average_side, 
                              filtered_column_means_average, 
                              filtered_column_means_ideal, 
                              filtered_column_means_reasonable)

average_side_vector_log <- mapply(is_average_side, 
                              log_filtered_column_means_average, 
                              log_filtered_column_means_ideal, 
                              log_filtered_column_means_reasonable)

# Count how many times reasonableness is on the "average side" of ideal
count_average_side <- sum(average_side_vector)
count_average_side_log <- sum(average_side_vector_log)

# Conduct a binomial test
binomial_result_avg_side <- binom.test(count_average_side, length(question_cols), p = 0.5, alternative = "greater")

binomial_result_avg_side_log <- binom.test(count_average_side_log, length(question_cols), p = 0.5, alternative = "greater")

print(binomial_result_avg_side)
print(binomial_result_avg_side_log)

# Step 5: Compute whether the mean reasonableness rating is both on the ideal side of average and average side of ideal, and compute a binomial test to assess whether the distribution differs from chance (with 1/3 as the chance rate).

# Determine if reasonableness is both on the "ideal side" of average and on the "average side" of ideal
is_both_sides <- function(average, ideal, reasonable) {
  ideal_side <- abs(reasonable - average) > abs(ideal - average)
  average_side <- abs(reasonable - ideal) > abs(average - ideal)
  if(ideal_side & average_side) return(1) else return(0)
}

both_sides_vector <- mapply(is_both_sides, 
                            filtered_column_means_average, 
                            filtered_column_means_ideal, 
                            filtered_column_means_reasonable)

both_sides_vector_log <- mapply(is_both_sides, 
                            log_filtered_column_means_average, 
                            log_filtered_column_means_ideal, 
                            log_filtered_column_means_reasonable)

# Count how many times reasonableness is on both sides
count_both_sides <- sum(both_sides_vector)
count_both_sides_log <- sum(both_sides_vector_log)

# Conduct a binomial test with 1/3 as the chance rate
binomial_result_both_sides <- binom.test(count_both_sides, length(question_cols), p = 1/3, alternative = "two.sided")

binomial_result_both_sides_log <- binom.test(count_both_sides_log, length(question_cols), p = 1/3, alternative = "two.sided")

print(binomial_result_both_sides)
print(binomial_result_both_sides_log)

```
# Analysis 3: Overall results, with median ratings 

```{r}

# Step 1: Exclude participants whose answer to Q19 does not equal 15 [comprehension/attention question].

# Completed in Part 1

# Step 2: For each of the 33 questions (e.g. Q1, Q2, but not Q19) and each of the 3 conditions (reasonable, average, or ideal), compute the median rating. 

filter_data_median <- function(data) {
  #### Loop through columns and apply filter
  for (question_cols in names(data)) {
    median <- median(data[[question_cols]], na.rm = TRUE)
  }
  return(data)
}

medians_average_pass <- filter_data_median(Data_All_Average_Pass1[, question_cols])
medians_reasonable_pass <- filter_data_median(Data_All_Reasonable_Pass1[, question_cols])
medians_ideal_pass <- filter_data_median(Data_All_Ideal_Pass1[, question_cols])

medians_average <- apply(medians_average_pass[, question_cols], 2, median, na.rm = TRUE)
medians_reasonable <- apply(medians_reasonable_pass[, question_cols], 2, median, na.rm = TRUE)
medians_ideal <- apply(medians_ideal_pass [, question_cols], 2, median, na.rm = TRUE)

```

```{r}

# Step 3: Convert median responses to a natural log scale

log_medians_average <- log(medians_average)
log_medians_reasonable <- log(medians_reasonable)
log_medians_ideal <- log(medians_ideal)
log_medians_ideal[log_medians_ideal == -Inf] <- 0


```

```{r}

# Step 4: Conduct three regressions: (i) one in which average predicts reasonable, (ii) one in which ideal predicts reasonable, (iii) one in which both average and ideal predict reasonable judgments. For each regression, record the AIC.

### Make a new DataFrame

dataforAICMedians <- data.frame(Reasonable = log_medians_reasonable, Average = log_medians_average, Ideal = log_medians_ideal)

### Conduct Regressions

#### Model I

Model1Medians <- lm(Reasonable ~ Average, data=dataforAICMedians)
AIC1Medians <- AIC(Model1Means)

#### Model II

Model2Medians <- lm(Reasonable ~ Ideal, data=dataforAICMedians)
AIC2Medians <- AIC(Model2Medians)

#### Model III

Model3Medians <- lm(Reasonable ~ Average + Ideal, data=dataforAICMedians)
AIC3Medians <- AIC(Model3Medians)

print(paste("AIC for Model 1 Medians - Average predicts Reasonable: ", AIC1Medians))
print(paste("AIC for Model 2 Medians - Ideal predicts Reasonable", AIC2Medians))
print(paste("AIC for Model 3 Medians - Average and Ideal predict Reasonable", AIC3Medians))

```
# Analysis 4: Overall results, intermediacy, with median ratings 

```{r}

# Determine if median reasonableness is on the "ideal side" of average for each question
is_ideal_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - average) <= abs(ideal - average), 1, 0)
}

ideal_side_vector <- mapply(is_ideal_side, 
                            medians_average, 
                            medians_ideal, 
                            medians_reasonable)

# Count how many times median reasonableness is on the "ideal side" of average
count_ideal_side <- sum(ideal_side_vector)

# Conduct a binomial test
binomial_result_ideal_median <- binom.test(count_ideal_side, length(medians_reasonable), p = 0.5, alternative = "greater")

print(binomial_result_ideal_median)

```

```{r}

# Determine if median reasonableness is on the "average side" of ideal
is_average_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - ideal) <= abs(average - ideal), 1, 0)
}

average_side_vector <- mapply(is_average_side, 
                              medians_average, 
                              medians_ideal, 
                              medians_reasonable)

# Count how many times median reasonableness is on the "average side" of ideal
count_average_side <- sum(average_side_vector)

# Conduct a binomial test
binomial_result_avg_side_medians <- binom.test(count_average_side, length(medians_reasonable), p = 0.5, alternative = "greater")

print(binomial_result_avg_side_medians)

```

```{r}

# Determine if median reasonableness is both on the "ideal side" of average and on the "average side" of ideal
is_both_sides <- function(average, ideal, reasonable) {
  ideal_side <- abs(reasonable - average) <= abs(ideal - average)
  average_side <- abs(reasonable - ideal) <= abs(average - ideal)
  if(ideal_side & average_side) return(1) else return(0)
}

both_sides_vector <- mapply(is_both_sides, 
                            medians_average, 
                            medians_ideal, 
                            medians_reasonable)

# Count how many times median reasonableness is on both sides
count_both_sides <- sum(both_sides_vector)

# Conduct a binomial test with 1/3 as the chance rate
binomial_result_both_sides_medians <- binom.test(count_both_sides, length(medians_reasonable), p = 1/3, alternative = "two.sided")

print(binomial_result_both_sides_medians)

```
# Analysis 5: Overall results, mean ratings [following Bear & Knobe 2016] BY COUNTRY

```{r}

# Split the data by country and store in a list function
split_data_by_country <- function(data) {
  split(data, data$Country_name)
}

# Function to filter data based on 3 SD criterion
filter_data_country <- function(data) {
  data %>%
    group_by(Country_name) %>%
    mutate(across(all_of(question_cols), 
                  ~ifelse(abs(. - mean(., na.rm = TRUE)) <= 3 * sd(., na.rm = TRUE), ., NA), .names = "filtered_{.col}"))
}

# Split by Country

Data_All_Average_by_country <- split_data_by_country(Data_All_Average_Pass1)
Data_All_Ideal_by_country <- split_data_by_country(Data_All_Ideal_Pass1)
Data_All_Reasonable_by_country <- split_data_by_country(Data_All_Reasonable_Pass1)


Data_All_Average_Filtered_by_country <- lapply(Data_All_Average_by_country, filter_data_country)
Data_All_Ideal_Filtered_by_country <- lapply(Data_All_Ideal_by_country, filter_data_country)
Data_All_Reasonable_Filtered_by_country <- lapply(Data_All_Reasonable_by_country, filter_data_country)


# Calculate the mean for each column after excluding outlier responses for each country
calculate_means_by_country <- function(data_list) {
  lapply(data_list, function(data) {
    data %>%
      summarise(across(starts_with("filtered_"), mean, na.rm = TRUE))
  })
}

filtered_column_means_average_by_country <- calculate_means_by_country(Data_All_Average_Filtered_by_country)
filtered_column_means_ideal_by_country <- calculate_means_by_country(Data_All_Ideal_Filtered_by_country)
filtered_column_means_reasonable_by_country <- calculate_means_by_country(Data_All_Reasonable_Filtered_by_country)

```

```{r}

# Convert to Log

log_transform_means <- function(data_list) {
  lapply(data_list, function(data) {
    data %>%
      mutate(across(where(is.numeric), log))  # Apply log only to numeric columns
  })
}

log_filtered_column_means_average_by_country <- log_transform_means(filtered_column_means_average_by_country)
log_filtered_column_means_ideal_by_country <- log_transform_means(filtered_column_means_ideal_by_country)
log_filtered_column_means_reasonable_by_country <- log_transform_means(filtered_column_means_reasonable_by_country)

```

```{r}

# Step 4: Calculate AIC by Country

# Remove the "Country_name" column for each country's data
log_filtered_column_means_average_by_country <- lapply(log_filtered_column_means_average_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

log_filtered_column_means_ideal_by_country <- lapply(log_filtered_column_means_ideal_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

log_filtered_column_means_reasonable_by_country <- lapply(log_filtered_column_means_reasonable_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

# If problematic values are identified, proceed to remove them and run the regression models
calculate_AIC_by_country <- function(average_data, ideal_data, reasonable_data) {
  lapply(names(average_data), function(country_name) {
    data_country <- data.frame(
      avg = unlist(average_data[[country_name]]),
      ideal = unlist(ideal_data[[country_name]]),
      reasonable = unlist(reasonable_data[[country_name]])
    )
  
    # Model I: average predicts reasonable
    model_I <- lm(reasonable ~ avg, data = data_country)
    aic_I <- AIC(model_I)
    
    # Model II: ideal predicts reasonable
    model_II <- lm(reasonable ~ ideal, data = data_country)
    aic_II <- AIC(model_II)
    
    # Model III: both average and ideal predict reasonable
    model_III <- lm(reasonable ~ avg + ideal, data = data_country)
    aic_III <- AIC(model_III)
    
    return(list(AIC_Model_I = aic_I, AIC_Model_II = aic_II, AIC_Model_III = aic_III))
  })
}


# Log Based AIC Median Data

AIC_by_country <- calculate_AIC_by_country(log_filtered_column_means_average_by_country, log_filtered_column_means_ideal_by_country, log_filtered_column_means_reasonable_by_country)

names(AIC_by_country) <- names(log_filtered_column_means_average_by_country)

# Non Log Based AIC Median Data

AIC_by_country <- calculate_AIC_by_country(log_filtered_column_means_average_by_country, log_filtered_column_means_ideal_by_country, log_filtered_column_means_reasonable_by_country)

names(AIC_by_country) <- names(log_filtered_column_means_average_by_country)

AIC_by_country

```
# Analysis 6: Overall results, intermediacy [following Bear & Knobe 2016] BY COUNTRY

```{r}

# Step 1 and 2 have been completed

# Step 3: For each question, compute whether the mean reasonableness rating is on the “ideal side” of average. Conduct a binomial test to assess whether the proportion of mean ratings on the “ideal side of the average” is greater than 50%. 

# Function to determine if the mean reasonableness rating is on the “ideal side” of average for each question
is_ideal_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - average) > abs(ideal - average), 1, 0)
}

# Apply the function for each country
ideal_side_results_by_country <- lapply(names(log_filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_filtered_column_means_average_by_country[[country_name]]
  ideal_data <- log_filtered_column_means_ideal_by_country[[country_name]]
  reasonable_data <- log_filtered_column_means_reasonable_by_country[[country_name]]
  
  mapply(is_ideal_side, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country
binomial_test_ideal_side_by_country <- lapply(ideal_side_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 0.5)
})

# Assign country names to each list element in binomial_test_results_by_country
names(binomial_test_ideal_side_by_country) <- names(log_filtered_column_means_average_by_country)

# View the binomial test results by country
binomial_test_ideal_side_results_by_country


```

```{r}

# Step 4: For each question, compute whether the mean reasonableness rating is on the “average side” of ideal. Conduct a binomial test to assess whether the proportion of mean ratings on the “average side of the ideal” is greater than 50%. 

# Function to determine if the mean reasonableness rating is on the “average side” of ideal for each question
is_average_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - ideal) > abs(average - ideal), 1, 0)
}

# Apply the function for each country
avg_side_results_by_country <- lapply(names(log_filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_filtered_column_means_average_by_country[[country_name]]
  ideal_data <- log_filtered_column_means_ideal_by_country[[country_name]]
  reasonable_data <- log_filtered_column_means_reasonable_by_country[[country_name]]
  
  mapply(is_average_side, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country
binomial_test_avg_side_by_country <- lapply(avg_side_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 0.5)
})

# Assign country names to each list element in binomial_test_avg_side_by_country
names(binomial_test_avg_side_by_country) <- names(log_filtered_column_means_average_by_country)

# View the binomial test results by country for average side of ideal
binomial_test_avg_side_by_country

```



```{r}

# Step 5: For each question, compute whether the mean reasonableness rating is both on the ideal side of average and average side of ideal, and compute a binomial test to assess whether the distribution differs from chance (with 1/3 as the chance rate).

# Function to determine if the mean reasonableness rating is on both sides

is_both_sides <- function(average, ideal, reasonable) {
  ideal_side <- abs(reasonable - average) > abs(ideal - average)
  average_side <- abs(reasonable - ideal) > abs(average - ideal)
  if(ideal_side & average_side) return(1) else return(0)
}

# Apply the function for each country
both_sides_results_by_country <- lapply(names(log_filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_filtered_column_means_average_by_country[[country_name]]
  ideal_data <- log_filtered_column_means_ideal_by_country[[country_name]]
  reasonable_data <- log_filtered_column_means_reasonable_by_country[[country_name]]
  
  mapply(is_both_sides, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country with 1/3 as the chance rate
binomial_test_both_sides_by_country <- lapply(both_sides_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 1/3)
})

names(binomial_test_both_sides_by_country) <- names(log_filtered_column_means_average_by_country)

binomial_test_both_sides_by_country

```

# Analysis 7: Overall results, with median ratings BY COUNTRY

```{r}

# Function to compute median for each question by country
compute_median_by_country <- function(data_list) {
  lapply(data_list, function(data) {
    data %>%
      group_by(Country_name) %>%
      summarise(across(all_of(question_cols), \(x) median(x, na.rm = TRUE)))
  })
}

# Apply the function to each condition
median_ratings_average_by_country <- compute_median_by_country(Data_All_Average_by_country)
median_ratings_ideal_by_country <- compute_median_by_country(Data_All_Ideal_by_country)
median_ratings_reasonable_by_country <- compute_median_by_country(Data_All_Reasonable_by_country)


```


```{r}

# Function to convert median ratings to natural log scale
convert_to_log_scale <- function(data_list) {
  lapply(data_list, function(data) {
    data %>%
      mutate(across(all_of(question_cols), log))
  })
}

# Apply the function to each condition's median ratings
log_median_ratings_average_by_country <- convert_to_log_scale(median_ratings_average_by_country)
log_median_ratings_ideal_by_country <- convert_to_log_scale(median_ratings_ideal_by_country)
log_median_ratings_reasonable_by_country <- convert_to_log_scale(median_ratings_reasonable_by_country)

# Function to replace -Inf values with 0
replace_minus_inf_with_zero <- function(data_list) {
  lapply(data_list, function(data) {
    data %>%
      mutate(across(everything(), ~replace(., is.infinite(.) & . < 0, 0)))
  })
}

# Apply the function to each dataset
log_median_ratings_average_by_country <- replace_minus_inf_with_zero(log_median_ratings_average_by_country)
log_median_ratings_ideal_by_country <- replace_minus_inf_with_zero(log_median_ratings_ideal_by_country)
log_median_ratings_reasonable_by_country <- replace_minus_inf_with_zero(log_median_ratings_reasonable_by_country)

View(log_median_ratings_average_by_country$Brazil)
print(log_median_ratings_average_by_country$Columbia)
print(log_median_ratings_average_by_country$Germany)
print(log_median_ratings_average_by_country$India)
print(log_median_ratings_average_by_country$Italy)
print(log_median_ratings_average_by_country$Lithiuania)
print(log_median_ratings_average_by_country$Netherlands)
print(log_median_ratings_average_by_country$Poland)
print(log_median_ratings_average_by_country$Spain)
print(log_median_ratings_average_by_country$USA)
print(log_median_ratings_average_by_country)
print(log_median_ratings_ideal_by_country)
print(log_median_ratings_reasonable_by_country)

View(log_median_ratings_average_by_country)
View(log_median_ratings_ideal_by_country)
View(log_median_ratings_reasonable_by_country)

```


```{r}

# Step 4: Calculate AIC by Country

# Remove the "Country_name" column for each country's data (log)
log_median_ratings_average_by_country <- lapply(log_median_ratings_average_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

log_median_ratings_ideal_by_country <- lapply(log_median_ratings_ideal_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

log_median_ratings_reasonable_by_country <- lapply(log_median_ratings_reasonable_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

# Remove the "Country_name" column for each country's data (not log values)
median_ratings_average_by_country <- lapply(median_ratings_average_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

median_ratings_ideal_by_country <- lapply(median_ratings_ideal_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

median_ratings_reasonable_by_country <- lapply(median_ratings_reasonable_by_country, function(df) {
  if ("Country_name" %in% colnames(df)) {
    df$Country_name <- NULL
  }
  return(df)
})

# Calculate AIC by Country Function

calculate_AIC_by_country <- function(average_data, ideal_data, reasonable_data) {
  lapply(names(average_data), function(country_name) {
    data_country <- data.frame(
      avg = unlist(average_data[[country_name]]),
      ideal = unlist(ideal_data[[country_name]]),
      reasonable = unlist(reasonable_data[[country_name]])
    )
  
    # Model I: average predicts reasonable
    model_I <- lm(reasonable ~ avg, data = data_country)
    aic_I <- AIC(model_I)
    
    # Model II: ideal predicts reasonable
    model_II <- lm(reasonable ~ ideal, data = data_country)
    aic_II <- AIC(model_II)
    
    # Model III: both average and ideal predict reasonable
    model_III <- lm(reasonable ~ avg + ideal, data = data_country)
    aic_III <- AIC(model_III)
    
    return(list(AIC_Model_I = aic_I, AIC_Model_II = aic_II, AIC_Model_III = aic_III))
  })
}

AIC_by_country_medians <- calculate_AIC_by_country(log_median_ratings_average_by_country, log_median_ratings_ideal_by_country, log_median_ratings_reasonable_by_country)

names(AIC_by_country_medians) <- names(filtered_column_means_average_by_country)

AIC_by_country_medians_nonlog <- calculate_AIC_by_country(median_ratings_average_by_country, median_ratings_ideal_by_country, median_ratings_reasonable_by_country)

names(AIC_by_country_medians) <- names(filtered_column_means_average_by_country)
names(AIC_by_country_medians_nonlog) <- names(filtered_column_means_average_by_country)

AIC_by_country_medians
AIC_by_country_medians_nonlog
```
# Analysis 8: Overall results, intermediacy, with median ratings BY COUNTRY

```{r}

# Step 1 and 2 have been completed

# Step 3: For each question, compute whether the median reasonableness rating is on the “ideal side” of average. Conduct a binomial test to assess whether the proportion of mean ratings on the “ideal side of the average” is greater than 50%. 

# Function to determine if the median reasonableness rating is on the “ideal side” of average for each question
is_ideal_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - average) > abs(ideal - average), 1, 0)
}

# Apply the function for each country
ideal_side_results_by_country <- lapply(names(filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_median_ratings_average_by_country[[country_name]]
  ideal_data <- log_median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- log_median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_ideal_side, avg_data, ideal_data, reasonable_data)
})

ideal_side_results_by_country <- lapply(names(filtered_column_means_average_by_country), function(country_name) {
  avg_data <- median_ratings_average_by_country[[country_name]]
  ideal_data <- median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_ideal_side, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country
binomial_median_test_ideal_side_results_by_country <- lapply(ideal_side_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 0.5)
})

# Assign country names to each list element in binomial_test_results_by_country
names(binomial_median_test_ideal_side_results_by_country) <- names(median_ratings_average_by_country)

# View the binomial test results by country
binomial_median_test_ideal_side_results_by_country


```

```{r}

# Step 4: For each question, compute whether the mean reasonableness rating is on the “average side” of ideal. Conduct a binomial test to assess whether the proportion of mean ratings on the “average side of the ideal” is greater than 50%. 

# Function to determine if the mean reasonableness rating is on the “average side” of ideal for each question
is_average_side <- function(average, ideal, reasonable) {
  ifelse(abs(reasonable - ideal) > abs(average - ideal), 1, 0)
}

# Apply the function for each country
avg_side_results_by_country <- lapply(names(log_filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_median_ratings_average_by_country[[country_name]]
  ideal_data <- log_median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- log_median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_average_side, avg_data, ideal_data, reasonable_data)
})

avg_side_results_by_country <- lapply(names(filtered_column_means_average_by_country), function(country_name) {
  avg_data <- median_ratings_average_by_country[[country_name]]
  ideal_data <- median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_average_side, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country
binomial_test_avg_side_by_country_median <- lapply(avg_side_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 0.5)
})

# Assign country names to each list element in binomial_test_avg_side_by_country
names(binomial_test_avg_side_by_country_median) <- names(filtered_column_means_average_by_country)

# View the binomial test results by country for average side of ideal
binomial_test_avg_side_by_country_median
```

```{r}

# Step 5: For each question, compute whether the mean reasonableness rating is both on the ideal side of average and average side of ideal, and compute a binomial test to assess whether the distribution differs from chance (with 1/3 as the chance rate).

# Function to determine if the mean reasonableness rating is on both sides

is_both_sides <- function(average, ideal, reasonable) {
  ideal_side <- abs(reasonable - average) > abs(ideal - average)
  average_side <- abs(reasonable - ideal) > abs(average - ideal)
  if(ideal_side & average_side) return(1) else return(0)
}

# Apply the function for each country
both_sides_results_by_country <- lapply(names(log_filtered_column_means_average_by_country), function(country_name) {
  avg_data <- log_median_ratings_average_by_country[[country_name]]
  ideal_data <- log_median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- log_median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_both_sides, avg_data, ideal_data, reasonable_data)
})

both_sides_results_by_country <- lapply(names(filtered_column_means_average_by_country), function(country_name) {
  avg_data <- median_ratings_average_by_country[[country_name]]
  ideal_data <- median_ratings_ideal_by_country[[country_name]]
  reasonable_data <- median_ratings_reasonable_by_country[[country_name]]
  
  mapply(is_both_sides, avg_data, ideal_data, reasonable_data)
})

# Conduct a binomial test for each country with 1/3 as the chance rate
binomial_test_both_sides_by_country_median <- lapply(both_sides_results_by_country, function(results) {
  sum_results <- sum(results)
  binom.test(sum_results, length(results), p = 1/3)
})

names(binomial_test_both_sides_by_country_median) <- names(filtered_column_means_average_by_country)

binomial_test_both_sides_by_country_median

```


# New Medians

```{r}

# Clean Country Median Data

# Function to convert a column to numeric, handling factors
convert_to_numeric <- function(column) {
  if (is.factor(column)) {
    as.numeric(as.character(column))
  } else {
    as.numeric(column)
  }
}

## Average Data

Brazil_Average_filtered <- Brazil_Average %>%
  filter(q19 == 15)

Colombia_Average_filtered <- Colombia_Average %>%
  filter(q19 == 15)

Germany_Average_filtered <- Germany_Average %>%
  filter(q19 == 15)

India_Average_filtered <- India_Average %>%
  filter(q19 == 15)

Italy_Average_filtered <- Italy_Average %>%
  filter(q19 == 15)

Lithiuania_Average_filtered <- Lithiuania_Average %>%
  filter(q19 == 15)

Netherlands_Average_filtered <- Netherlands_Average %>%
  filter(q19 == 15)

Poland_Average_filtered <- Poland_Average %>%
  filter(q19 == 15)

Spain_Average_filtered <- Spain_Average %>%
  filter(q19 == 15)

USA_Average_filtered <- USA_Average %>%
  filter(q19 == 15)

## Ideal Data

Brazil_Ideal_filtered <- Brazil_Ideal %>%
  filter(q19 == 15)

Colombia_Ideal_filtered <- Colombia_Ideal %>%
  filter(q19 == 15)

Germany_Ideal_filtered <- Germany_Ideal %>%
  filter(q19 == 15)

India_Ideal_filtered <- India_Ideal %>%
  filter(q19 == 15)

Italy_Ideal_filtered <- Italy_Ideal %>%
  filter(q19 == 15)

Lithiuania_Ideal_filtered <- Lithiuania_Ideal %>%
  filter(q19 == 15)

Netherlands_Ideal_filtered <- Netherlands_Ideal %>%
  filter(q19 == 15)

Poland_Ideal_filtered <- Poland_Ideal %>%
  filter(q19 == 15)

Spain_Ideal_filtered <- Spain_Ideal %>%
  filter(q19 == 15)

USA_Ideal_filtered <- USA_Ideal %>%
  filter(q19 == 15)

## Reasonable Data

Brazil_Reasonable_filtered <- Brazil_Reasonable %>%
  filter(q19 == 15)

Colombia_Reasonable_filtered <- Colombia_Reasonable %>%
  filter(q19 == 15)

Germany_Reasonable_filtered <- Germany_Reasonable %>%
  filter(q19 == 15)

India_Reasonable_filtered <- India_Reasonable %>%
  filter(q19 == 15)

Italy_Reasonable_filtered <- Italy_Reasonable %>%
  filter(q19 == 15)

Lithiuania_Reasonable_filtered <- Lithiuania_Reasonable %>%
  filter(q19 == 15)

Netherlands_Reasonable_filtered <- Netherlands_Reasonable %>%
  filter(q19 == 15)

Poland_Reasonable_filtered <- Poland_Reasonable %>%
  filter(q19 == 15)

Spain_Reasonable_filtered <- Spain_Reasonable %>%
  filter(q19 == 15)

USA_Reasonable_filtered <- USA_Reasonable %>%
  filter(q19 == 15)

# Convert columns 1-34 in each dataframe to numeric

# For Average Data
Brazil_Average_filtered <- Brazil_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Colombia_Average_filtered <- Colombia_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Germany_Average_filtered <- Germany_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
India_Average_filtered <- India_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Italy_Average_filtered <- Italy_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Lithiuania_Average_filtered <- Lithiuania_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Netherlands_Average_filtered <- Netherlands_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Poland_Average_filtered <- Poland_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Spain_Average_filtered <- Spain_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
USA_Average_filtered <- USA_Average_filtered %>% mutate_at(vars(1:34), convert_to_numeric)

# For Ideal Data
Brazil_Ideal_filtered <- Brazil_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Colombia_Ideal_filtered <- Colombia_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Germany_Ideal_filtered <- Germany_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
India_Ideal_filtered <- India_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Italy_Ideal_filtered <- Italy_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Lithiuania_Ideal_filtered <- Lithiuania_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Netherlands_Ideal_filtered <- Netherlands_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Poland_Ideal_filtered <- Poland_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Spain_Ideal_filtered <- Spain_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
USA_Ideal_filtered <- USA_Ideal_filtered %>% mutate_at(vars(1:34), convert_to_numeric)

# For Reasonable Data
Brazil_Reasonable_filtered <- Brazil_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Colombia_Reasonable_filtered <- Colombia_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Germany_Reasonable_filtered <- Germany_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
India_Reasonable_filtered <- India_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Italy_Reasonable_filtered <- Italy_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Lithiuania_Reasonable_filtered <- Lithiuania_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Netherlands_Reasonable_filtered <- Netherlands_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Poland_Reasonable_filtered <- Poland_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
Spain_Reasonable_filtered <- Spain_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)
USA_Reasonable_filtered <- USA_Reasonable_filtered %>% mutate_at(vars(1:34), convert_to_numeric)

```

# Analysis of New Medians

```{r}

# Specify the columns you're interested in
selected_columns <- c(1:18, 20:34)

# Calculate medians for each specified column in the filtered data

# For Average Data
Brazil_Average_medians <- apply(Brazil_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Colombia_Average_medians <- apply(Colombia_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Germany_Average_medians <- apply(Germany_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
India_Average_medians <- apply(India_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Italy_Average_medians <- apply(Italy_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Lithiuania_Average_medians <- apply(Lithiuania_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Netherlands_Average_medians <- apply(Netherlands_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Poland_Average_medians <- apply(Poland_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
Spain_Average_medians <- apply(Spain_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)
USA_Average_medians <- apply(USA_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)

# For Ideal Data
Brazil_Ideal_medians <- apply(Brazil_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Colombia_Ideal_medians <- apply(Colombia_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Germany_Ideal_medians <- apply(Germany_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
India_Ideal_medians <- apply(India_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Italy_Ideal_medians <- apply(Italy_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Lithiuania_Ideal_medians <- apply(Lithiuania_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Netherlands_Ideal_medians <- apply(Netherlands_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Poland_Ideal_medians <- apply(Poland_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
Spain_Ideal_medians <- apply(Spain_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)
USA_Ideal_medians <- apply(USA_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)

# For Reasonable Data
Brazil_Reasonable_medians <- apply(Brazil_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Colombia_Reasonable_medians <- apply(Colombia_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Germany_Reasonable_medians <- apply(Germany_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
India_Reasonable_medians <- apply(India_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Italy_Reasonable_medians <- apply(Italy_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Lithiuania_Reasonable_medians <- apply(Lithiuania_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Netherlands_Reasonable_medians <- apply(Netherlands_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Poland_Reasonable_medians <- apply(Poland_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
Spain_Reasonable_medians <- apply(Spain_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)
USA_Reasonable_medians <- apply(USA_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)

# Define column names
column_names <- c(paste0("Q", 1:18), paste0("Q", 20:34))

# Convert medians to data frames with the desired column names

# For Average Data
Brazil_Average_medians <- data.frame(t(apply(Brazil_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Brazil_Average_medians) <- column_names

Colombia_Average_medians <- data.frame(t(apply(Colombia_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Colombia_Average_medians) <- column_names

Germany_Average_medians <- data.frame(t(apply(Germany_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Germany_Average_medians) <- column_names

India_Average_medians <- data.frame(t(apply(India_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(India_Average_medians) <- column_names

Italy_Average_medians <- data.frame(t(apply(Italy_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Italy_Average_medians) <- column_names

Lithiuania_Average_medians <- data.frame(t(apply(Lithiuania_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Lithiuania_Average_medians) <- column_names

Netherlands_Average_medians <- data.frame(t(apply(Netherlands_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Netherlands_Average_medians) <- column_names

Poland_Average_medians <- data.frame(t(apply(Poland_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Poland_Average_medians) <- column_names

Spain_Average_medians <- data.frame(t(apply(Spain_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Spain_Average_medians) <- column_names

USA_Average_medians <- data.frame(t(apply(USA_Average_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(USA_Average_medians) <- column_names

# For Ideal Data
Brazil_Ideal_medians <- data.frame(t(apply(Brazil_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Brazil_Ideal_medians) <- column_names

Colombia_Ideal_medians <- data.frame(t(apply(Colombia_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Colombia_Ideal_medians) <- column_names

Germany_Ideal_medians <- data.frame(t(apply(Germany_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Germany_Ideal_medians) <- column_names

India_Ideal_medians <- data.frame(t(apply(India_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(India_Ideal_medians) <- column_names

Italy_Ideal_medians <- data.frame(t(apply(Italy_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Italy_Ideal_medians) <- column_names

Lithiuania_Ideal_medians <- data.frame(t(apply(Lithiuania_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Lithiuania_Ideal_medians) <- column_names

Netherlands_Ideal_medians <- data.frame(t(apply(Netherlands_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Netherlands_Ideal_medians) <- column_names

Poland_Ideal_medians <- data.frame(t(apply(Poland_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Poland_Ideal_medians) <- column_names

Spain_Ideal_medians <- data.frame(t(apply(Spain_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Spain_Ideal_medians) <- column_names

USA_Ideal_medians <- data.frame(t(apply(USA_Ideal_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(USA_Ideal_medians) <- column_names

# For Reasonable Data
Brazil_Reasonable_medians <- data.frame(t(apply(Brazil_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Brazil_Reasonable_medians) <- column_names

Colombia_Reasonable_medians <- data.frame(t(apply(Colombia_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Colombia_Reasonable_medians) <- column_names

Germany_Reasonable_medians <- data.frame(t(apply(Germany_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Germany_Reasonable_medians) <- column_names

India_Reasonable_medians <- data.frame(t(apply(India_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(India_Reasonable_medians) <- column_names

Italy_Reasonable_medians <- data.frame(t(apply(Italy_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Italy_Reasonable_medians) <- column_names

Lithiuania_Reasonable_medians <- data.frame(t(apply(Lithiuania_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Lithiuania_Reasonable_medians) <- column_names

Netherlands_Reasonable_medians <- data.frame(t(apply(Netherlands_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Netherlands_Reasonable_medians) <- column_names

Poland_Reasonable_medians <- data.frame(t(apply(Poland_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Poland_Reasonable_medians) <- column_names

Spain_Reasonable_medians <- data.frame(t(apply(Spain_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(Spain_Reasonable_medians) <- column_names

USA_Reasonable_medians <- data.frame(t(apply(USA_Reasonable_filtered[, selected_columns], 2, median, na.rm = TRUE)))
colnames(USA_Reasonable_medians) <- column_names

```

# Conduct AIC for Each Country

```{r}

# Unlist the median values and define them as vectors

# For Average Data
Brazil_Average_vector <- unlist(Brazil_Average_medians)
Colombia_Average_vector <- unlist(Colombia_Average_medians)
Germany_Average_vector <- unlist(Germany_Average_medians)
India_Average_vector <- unlist(India_Average_medians)
Italy_Average_vector <- unlist(Italy_Average_medians)
Lithiuania_Average_vector <- unlist(Lithiuania_Average_medians)
Netherlands_Average_vector <- unlist(Netherlands_Average_medians)
Poland_Average_vector <- unlist(Poland_Average_medians)
Spain_Average_vector <- unlist(Spain_Average_medians)
USA_Average_vector <- unlist(USA_Average_medians)

# For Ideal Data
Brazil_Ideal_vector <- unlist(Brazil_Ideal_medians)
Colombia_Ideal_vector <- unlist(Colombia_Ideal_medians)
Germany_Ideal_vector <- unlist(Germany_Ideal_medians)
India_Ideal_vector <- unlist(India_Ideal_medians)
Italy_Ideal_vector <- unlist(Italy_Ideal_medians)
Lithiuania_Ideal_vector <- unlist(Lithiuania_Ideal_medians)
Netherlands_Ideal_vector <- unlist(Netherlands_Ideal_medians)
Poland_Ideal_vector <- unlist(Poland_Ideal_medians)
Spain_Ideal_vector <- unlist(Spain_Ideal_medians)
USA_Ideal_vector <- unlist(USA_Ideal_medians)

# For Reasonable Data
Brazil_Reasonable_vector <- unlist(Brazil_Reasonable_medians)
Colombia_Reasonable_vector <- unlist(Colombia_Reasonable_medians)
Germany_Reasonable_vector <- unlist(Germany_Reasonable_medians)
India_Reasonable_vector <- unlist(India_Reasonable_medians)
Italy_Reasonable_vector <- unlist(Italy_Reasonable_medians)
Lithiuania_Reasonable_vector <- unlist(Lithiuania_Reasonable_medians)
Netherlands_Reasonable_vector <- unlist(Netherlands_Reasonable_medians)
Poland_Reasonable_vector <- unlist(Poland_Reasonable_medians)
Spain_Reasonable_vector <- unlist(Spain_Reasonable_medians)
USA_Reasonable_vector <- unlist(USA_Reasonable_medians)

# Create them to Log Values and Add One to Ensure INF values are not possible

# For Brazil
Log_Brazil_Ideal_vector <- log(Brazil_Ideal_vector + 1)
Log_Brazil_Reasonable_vector <- log(Brazil_Reasonable_vector + 1)
Log_Brazil_Average_vector <- log(Brazil_Average_vector + 1)

# For Colombia
Log_Colombia_Ideal_vector <- log(Colombia_Ideal_vector + 1)
Log_Colombia_Reasonable_vector <- log(Colombia_Reasonable_vector + 1)
Log_Colombia_Average_vector <- log(Colombia_Average_vector + 1)

# For Germany
Log_Germany_Ideal_vector <- log(Germany_Ideal_vector + 1)
Log_Germany_Reasonable_vector <- log(Germany_Reasonable_vector + 1)
Log_Germany_Average_vector <- log(Germany_Average_vector + 1)

# For India
Log_India_Ideal_vector <- log(India_Ideal_vector + 1)
Log_India_Reasonable_vector <- log(India_Reasonable_vector + 1)
Log_India_Average_vector <- log(India_Average_vector + 1)

# For Italy
Log_Italy_Ideal_vector <- log(Italy_Ideal_vector + 1)
Log_Italy_Reasonable_vector <- log(Italy_Reasonable_vector + 1)
Log_Italy_Average_vector <- log(Italy_Average_vector + 1)

# For Lithuania
Log_Lithiuania_Ideal_vector <- log(Lithiuania_Ideal_vector + 1)
Log_Lithiuania_Reasonable_vector <- log(Lithiuania_Reasonable_vector + 1)
Log_Lithiuania_Average_vector <- log(Lithiuania_Average_vector + 1)

# For Netherlands
Log_Netherlands_Ideal_vector <- log(Netherlands_Ideal_vector + 1)
Log_Netherlands_Reasonable_vector <- log(Netherlands_Reasonable_vector + 1)
Log_Netherlands_Average_vector <- log(Netherlands_Average_vector + 1)

# For Poland
Log_Poland_Ideal_vector <- log(Poland_Ideal_vector + 1)
Log_Poland_Reasonable_vector <- log(Poland_Reasonable_vector + 1)
Log_Poland_Average_vector <- log(Poland_Average_vector + 1)

# For Spain
Log_Spain_Ideal_vector <- log(Spain_Ideal_vector + 1)
Log_Spain_Reasonable_vector <- log(Spain_Reasonable_vector + 1)
Log_Spain_Average_vector <- log(Spain_Average_vector + 1)

# For USA
Log_USA_Ideal_vector <- log(USA_Ideal_vector + 1)
Log_USA_Reasonable_vector <- log(USA_Reasonable_vector + 1)
Log_USA_Average_vector <- log(USA_Average_vector + 1)

# Brazil
model_I_Brazil <- lm(Log_Brazil_Reasonable_vector ~ Log_Brazil_Average_vector)
aic_I_Brazil <- AIC(model_I_Brazil)

model_II_Brazil <- lm(Log_Brazil_Reasonable_vector ~ Log_Brazil_Ideal_vector)
aic_II_Brazil <- AIC(model_II_Brazil)

model_III_Brazil <- lm(Log_Brazil_Reasonable_vector ~ Log_Brazil_Average_vector + Log_Brazil_Ideal_vector)
aic_III_Brazil <- AIC(model_III_Brazil)

# Colombia
model_I_Colombia <- lm(Log_Colombia_Reasonable_vector ~ Log_Colombia_Average_vector)
aic_I_Colombia <- AIC(model_I_Colombia)

model_II_Colombia <- lm(Log_Colombia_Reasonable_vector ~ Log_Colombia_Ideal_vector)
aic_II_Colombia <- AIC(model_II_Colombia)

model_III_Colombia <- lm(Log_Colombia_Reasonable_vector ~ Log_Colombia_Average_vector + Log_Colombia_Ideal_vector)
aic_III_Colombia <- AIC(model_III_Colombia)

# Germany
model_I_Germany <- lm(Log_Germany_Reasonable_vector ~ Log_Germany_Average_vector)
aic_I_Germany <- AIC(model_I_Germany)

model_II_Germany <- lm(Log_Germany_Reasonable_vector ~ Log_Germany_Ideal_vector)
aic_II_Germany <- AIC(model_II_Germany)

model_III_Germany <- lm(Log_Germany_Reasonable_vector ~ Log_Germany_Average_vector + Log_Germany_Ideal_vector)
aic_III_Germany <- AIC(model_III_Germany)

# India
model_I_India <- lm(Log_India_Reasonable_vector ~ Log_India_Average_vector)
aic_I_India <- AIC(model_I_India)

model_II_India <- lm(Log_India_Reasonable_vector ~ Log_India_Ideal_vector)
aic_II_India <- AIC(model_II_India)

model_III_India <- lm(Log_India_Reasonable_vector ~ Log_India_Average_vector + Log_India_Ideal_vector)
aic_III_India <- AIC(model_III_India)

# Italy
model_I_Italy <- lm(Log_Italy_Reasonable_vector ~ Log_Italy_Average_vector)
aic_I_Italy <- AIC(model_I_Italy)

model_II_Italy <- lm(Log_Italy_Reasonable_vector ~ Log_Italy_Ideal_vector)
aic_II_Italy <- AIC(model_II_Italy)

model_III_Italy <- lm(Log_Italy_Reasonable_vector ~ Log_Italy_Average_vector + Log_Italy_Ideal_vector)
aic_III_Italy <- AIC(model_III_Italy)

# Lithuania
model_I_Lithiuania <- lm(Log_Lithiuania_Reasonable_vector ~ Log_Lithiuania_Average_vector)
aic_I_Lithiuania <- AIC(model_I_Lithiuania)

model_II_Lithiuania <- lm(Log_Lithiuania_Reasonable_vector ~ Log_Lithiuania_Ideal_vector)
aic_II_Lithiuania <- AIC(model_II_Lithiuania)

model_III_Lithiuania <- lm(Log_Lithiuania_Reasonable_vector ~ Log_Lithiuania_Average_vector + Log_Lithiuania_Ideal_vector)
aic_III_Lithiuania <- AIC(model_III_Lithiuania)

# Netherlands
model_I_Netherlands <- lm(Log_Netherlands_Reasonable_vector ~ Log_Netherlands_Average_vector)
aic_I_Netherlands <- AIC(model_I_Netherlands)

model_II_Netherlands <- lm(Log_Netherlands_Reasonable_vector ~ Log_Netherlands_Ideal_vector)
aic_II_Netherlands <- AIC(model_II_Netherlands)

model_III_Netherlands <- lm(Log_Netherlands_Reasonable_vector ~ Log_Netherlands_Average_vector + Log_Netherlands_Ideal_vector)
aic_III_Netherlands <- AIC(model_III_Netherlands)

# Poland
model_I_Poland <- lm(Log_Poland_Reasonable_vector ~ Log_Poland_Average_vector)
aic_I_Poland <- AIC(model_I_Poland)

model_II_Poland <- lm(Log_Poland_Reasonable_vector ~ Log_Poland_Ideal_vector)
aic_II_Poland <- AIC(model_II_Poland)

model_III_Poland <- lm(Log_Poland_Reasonable_vector ~ Log_Poland_Average_vector + Log_Poland_Ideal_vector)
aic_III_Poland <- AIC(model_III_Poland)

# Spain
model_I_Spain <- lm(Log_Spain_Reasonable_vector ~ Log_Spain_Average_vector)
aic_I_Spain <- AIC(model_I_Spain)

model_II_Spain <- lm(Log_Spain_Reasonable_vector ~ Log_Spain_Ideal_vector)
aic_II_Spain <- AIC(model_II_Spain)

model_III_Spain <- lm(Log_Spain_Reasonable_vector ~ Log_Spain_Average_vector + Log_Spain_Ideal_vector)
aic_III_Spain <- AIC(model_III_Spain)

# USA
model_I_USA <- lm(Log_USA_Reasonable_vector ~ Log_USA_Average_vector)
aic_I_USA <- AIC(model_I_USA)

model_II_USA <- lm(Log_USA_Reasonable_vector ~ Log_USA_Ideal_vector)
aic_II_USA <- AIC(model_II_USA)

model_III_USA <- lm(Log_USA_Reasonable_vector ~ Log_USA_Average_vector + Log_USA_Ideal_vector)
aic_III_USA <- AIC(model_III_USA)

# AIC values for Brazil
aic_values_Brazil <- c(aic_I_Brazil, aic_II_Brazil, aic_III_Brazil)

# AIC values for Colombia
aic_values_Colombia <- c(aic_I_Colombia, aic_II_Colombia, aic_III_Colombia)

# AIC values for Germany
aic_values_Germany <- c(aic_I_Germany, aic_II_Germany, aic_III_Germany)

# AIC values for India
aic_values_India <- c(aic_I_India, aic_II_India, aic_III_India)

# AIC values for Italy
aic_values_Italy <- c(aic_I_Italy, aic_II_Italy, aic_III_Italy)

# AIC values for Lithuania
aic_values_Lithuania <- c(aic_I_Lithiuania, aic_II_Lithiuania, aic_III_Lithiuania)

# AIC values for Netherlands
aic_values_Netherlands <- c(aic_I_Netherlands, aic_II_Netherlands, aic_III_Netherlands)

# AIC values for Poland
aic_values_Poland <- c(aic_I_Poland, aic_II_Poland, aic_III_Poland)

# AIC values for Spain
aic_values_Spain <- c(aic_I_Spain, aic_II_Spain, aic_III_Spain)

# AIC values for USA
aic_values_USA <- c(aic_I_USA, aic_II_USA, aic_III_USA)

aic_dataframe <- data.frame(
  Country = c("Brazil", "Colombia", "Germany", "India", "Italy", "Lithuania", "Netherlands", "Poland", "Spain", "USA"),
  Model_I = c(aic_I_Brazil, aic_I_Colombia, aic_I_Germany, aic_I_India, aic_I_Italy, aic_I_Lithiuania, aic_I_Netherlands, aic_I_Poland, aic_I_Spain, aic_I_USA),
  Model_II = c(aic_II_Brazil, aic_II_Colombia, aic_II_Germany, aic_II_India, aic_II_Italy, aic_II_Lithiuania, aic_II_Netherlands, aic_II_Poland, aic_II_Spain, aic_II_USA),
  Model_III = c(aic_III_Brazil, aic_III_Colombia, aic_III_Germany, aic_III_India, aic_III_Italy, aic_III_Lithiuania, aic_III_Netherlands, aic_III_Poland, aic_III_Spain, aic_III_USA)
)

print(aic_dataframe)

```